# ü§ñ AI-–∞–≥–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è NCL

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ **LangChain** –∏ **OpenAI GPT** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ (2010-2015). –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ - –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∏ –¥–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd ai_agent
pip install -r requirements.txt

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞
# –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env! –°–æ–∑–¥–∞–π—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ env.example
copy env.example .env   # Windows
cp env.example .env     # Linux/Mac
notepad .env            # –∑–∞—Ç–µ–º –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–ª—é—á–∏

# 3. –ó–∞–ø—É—Å–∫ Streamlit –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
streamlit run app_streamlit_advanced.py
# –û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8501

# –ò–ª–∏ CLI
python cli.py
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤

```
–°–∫–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö?
–ö–∞–∫–∞—è –¥–æ–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª—è –≤ –ø—Ä–æ—Å—Ä–æ—á–∫–µ 30+ –¥–Ω–µ–π?
–ü–æ–∫–∞–∂–∏ —Ç–æ–ø-5 –º–µ—Å—è—Ü–µ–≤ –ø–æ –æ–±—ä–µ–º—É –≤—ã–¥–∞—á
–î–∏–Ω–∞–º–∏–∫–∞ PAR30 –ø–æ –º–µ—Å—è—Ü–∞–º –≤ 2014-2015
–ö–∞–∫ —Å—Ç–∞–≤–∫–∞ –¶–ë –≤–ª–∏—è–ª–∞ –Ω–∞ –≤—ã–¥–∞—á–∏?
IFRS9 stage mix –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É
```

## üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### 1. Streamlit –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:**
```bash
streamlit run app_streamlit.py
```
- –ß–∞—Ç —Å AI-–∞–≥–µ–Ω—Ç–æ–º
- –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:**
```bash
streamlit run app_streamlit_advanced.py
# –ò–ª–∏: run_streamlit.bat (Windows) / ./run_streamlit.sh (Linux)
```
- üí¨ –ß–∞—Ç —Å AI-–∞–≥–µ–Ω—Ç–æ–º
- üìä –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ (–≤—ã–¥–∞—á–∏, PAR, DPD)
- üîß SQL –ø–µ—Å–æ—á–Ω–∏—Ü–∞
- üìú –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```bash
python cli.py
# –ò–ª–∏: run.bat (Windows) / ./run.sh (Linux)
```

**–ö–æ–º–∞–Ω–¥—ã:**
- `/help` - —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `/examples` - –ø—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤
- `/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
- `/sql SELECT ...` - –ø—Ä—è–º–æ–π SQL
- `/save` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç
- `/history` - –∏—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–∏

### 3. –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```bash
# –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏
python batch.py --create-template

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Ñ–∞–π–ª–∞
python batch.py --input questions.txt

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ reports/ (HTML, JSON, CSV)
```

### 4. –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø

```python
from ai_agent import CreditSimulationAgent
from ai_agent.config import load_config

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
config = load_config()
agent = CreditSimulationAgent(config)

# –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
result = agent.query("–°–∫–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ –±–∞–∑–µ?")
if result["success"]:
    print(result["answer"])

# –ü—Ä—è–º–æ–π SQL
data = agent.run_raw_sql("SELECT COUNT(*) FROM loan_issue")
print(data)
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `.env` (—Å–æ–∑–¥–∞–π—Ç–µ –∏–∑ `env.example`):

```env
# OpenAI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_TEMPERATURE=0.1
OPENAI_MAX_TOKENS=1000

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_PATH=../credit_sim.db

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO
LOG_FILE=logs/agent.log
HISTORY_FILE=logs/agent_history.jsonl
```

## üìä –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –¢–∏–ø—ã –∞–Ω–∞–ª–∏–∑–∞:
- **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –æ–±—ä–µ–º—ã, —Å—Ä–µ–¥–Ω–∏–µ —á–µ–∫–∏
- **–†–∏—Å–∫-–º–µ—Ç—Ä–∏–∫–∏** - PAR30/60/90, DPD distribution, Cure/Default rates
- **IFRS9 Stage Mix** - Stage 1/2/3 –∞–Ω–∞–ª–∏–∑ –∏ –¥–∏–Ω–∞–º–∏–∫–∞
- **Vintage Analysis** - –∫–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –º–µ—Å—è—Ü–∞–º –≤—ã–¥–∞—á–∏
- **–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞** - –≤–ª–∏—è–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –¶–ë, –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã, —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
- **–ê–Ω–∞–ª–∏–∑ –ø–ª–∞—Ç–µ–∂–µ–π** - Actual vs Scheduled, –¥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–æ–≥–∞—à–µ–Ω–∏—è

### Streamlit –≥—Ä–∞—Ñ–∏–∫–∏:
- üìà –î–∏–Ω–∞–º–∏–∫–∞ –≤—ã–¥–∞—á (bar chart)
- üìâ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ (line chart)  
- üéØ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ DPD (pie charts)
- ‚ö†Ô∏è PAR30/60/90 –¥–∏–Ω–∞–º–∏–∫–∞ (multi-line)
- üí∞ –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (metric cards)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
ai_agent/
‚îú‚îÄ‚îÄ config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Pydantic)
‚îú‚îÄ‚îÄ agent.py                # LangChain SQL Agent
‚îú‚îÄ‚îÄ cli.py                  # CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ app_streamlit.py        # Streamlit –±–∞–∑–æ–≤—ã–π
‚îú‚îÄ‚îÄ app_streamlit_advanced.py  # Streamlit —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π
‚îú‚îÄ‚îÄ batch.py                # –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ examples.py             # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ .env                    # API –∫–ª—é—á–∏ (–Ω–µ –≤ git)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å NCL:**
- **Dash** (–ø–æ—Ä—Ç 8050) ‚Üí –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ç—á–µ—Ç—ã
- **Streamlit** (–ø–æ—Ä—Ç 8501) ‚Üí –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π AI-–∞–Ω–∞–ª–∏–∑, NLP-–∑–∞–ø—Ä–æ—Å—ã
- **–û–±—â–∞—è –ë–î** ‚Üí `credit_sim.db`

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **LangChain 0.1.0** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è LLM –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **OpenAI GPT-3.5/4** - —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å
- **Streamlit 1.29.0** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **SQLAlchemy 2.0** - —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- **Plotly** - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
- **Pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "OPENAI_API_KEY not found"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat .env  # Linux/Mac
type .env # Windows

# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å: OPENAI_API_KEY=sk-...
```

### –û—à–∏–±–∫–∞: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ:
cd ..
python -m credit_simulation.src.main
python -m credit_simulation.src.module2_simulator
```

### –û—à–∏–±–∫–∞: "Module not found"
```bash
pip install -r requirements.txt --force-reinstall
```

### Streamlit –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç
```bash
streamlit run app_streamlit.py --server.port 8502
```

## üìù –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

**–ü—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å:**
```
‚ùì –°–∫–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ –±–∞–∑–µ?

üí° –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è 50,432 –∫—Ä–µ–¥–∏—Ç–∞,
   –≤—ã–¥–∞–Ω–Ω—ã—Ö —Å 2010-01-01 –ø–æ 2015-12-31.
```

**–†–∏—Å–∫-–∞–Ω–∞–ª–∏–∑:**
```
‚ùì –ö–∞–∫–∞—è –¥–æ–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª—è –≤ –ø—Ä–æ—Å—Ä–æ—á–∫–µ 30+ –¥–Ω–µ–π?

üí° PAR30 –Ω–∞ –¥–µ–∫–∞–±—Ä—å 2015 —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 8.3%.
   –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ 8.3% –æ—Ç –æ–±—â–µ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ 
   –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–ª–≥–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–æ—Å—Ä–æ—á–∫–µ –±–æ–ª–µ–µ 30 –¥–Ω–µ–π.
```

**–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞:**
```
‚ùì –ö–∞–∫ —Å—Ç–∞–≤–∫–∞ –¶–ë –≤–ª–∏—è–ª–∞ –Ω–∞ –æ–±—ä–µ–º –≤—ã–¥–∞—á –≤ 2014-2015?

üí° –ü—Ä–∏ —Ä–æ—Å—Ç–µ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ –¶–ë —Å 5.5% –¥–æ 17%
   (–¥–µ–∫–∞–±—Ä—å 2013 - –¥–µ–∫–∞–±—Ä—å 2014), –æ–±—ä–µ–º –≤—ã–¥–∞—á
   —Å–æ–∫—Ä–∞—Ç–∏–ª—Å—è –Ω–∞ 34%. –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è: -0.72
   (—Å–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å).
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–ê–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 3 —Ç–∞–±–ª–∏—Ü–∞–º–∏ SQLite:

**1. loan_issue** - –í—ã–¥–∞—á–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
- loan_id, issue_date, loan_amount, interest_rate
- term_months, product_type
- macro_rate_cbr, macro_employment_rate
- season_k_issue, season_k_amount

**2. credit_fact_history** - –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–∫—Ç
- loan_id, period_month, MOB
- balance_principal, overdue_principal
- scheduled_payment, actual_payment
- DPD_bucket, status

**3. macro_params_log** - –ú–∞–∫—Ä–æ–ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- year_month, rate_cbr
- employment_rate, unemployment_rate
- macro_index

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ API –∫–ª—é—á–∏ –≤ `.env` (–Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ git)
- ‚úÖ –¢–æ–ª—å–∫–æ SELECT –∑–∞–ø—Ä–æ—Å—ã (LangChain –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Pydantic)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ CI/CD –≤–º–µ—Å—Ç–æ —è–≤–Ω—ã—Ö –∫–ª—é—á–µ–π.
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `git status` –ø–µ—Ä–µ–¥ –ø—É—à–µ–º, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å `.env`, `logs/`, `outputs/`.

## üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è

| –í—ã–¥–∞—á–∏ | PAR/DPD | Vintages |
|---|---|---|
| ![Issuance](../docs/img/issuance.png) | ![PAR](../docs/img/par.png) | ![Vintages](../docs/img/vintages.png) |

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```txt
langchain==0.1.0
langchain-openai==0.0.2
openai==1.7.2
streamlit==1.29.0
sqlalchemy==2.0.32
plotly==5.18.0
pandas==2.0.3
pydantic==2.5.0
```

## üéØ –ò—Ç–æ–≥–æ

**–°–æ–∑–¥–∞–Ω–æ:** 7 –º–æ–¥—É–ª–µ–π Python + –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã  
**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:** Streamlit (2 –≤–µ—Ä—Å–∏–∏) + CLI + Batch + API  
**–§—É–Ω–∫—Ü–∏–∏:** Natural Language ‚Üí SQL ‚Üí Business Insights  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

**–í–æ–ø—Ä–æ—Å—ã?** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python examples.py` –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤.
